# Proposal: Initialize Werewolf Multi-Agent Platform

## Change ID
`001-initialize-werewolf-platform`

## Status
🟢 **READY FOR SPEC** - Open Questions已明确，准备编写详细规范

## Overview

创建一个狼人杀多智能体游戏平台，允许人类玩家与由不同大语言模型驱动的AI智能体混合对战。

## Motivation

### 为什么需要这个平台？

1. **AI推理能力研究**：狼人杀游戏需要复杂的逻辑推理、欺骗和说服能力，是测试LLM能力的理想场景
2. **多模型对比**：可以观察不同模型（GPT、Claude、Qwen等）在同一游戏中的表现差异
3. **娱乐性与教育性**：新手可以通过与AI对战学习狼人杀策略
4. **人机协作探索**：研究人类与AI在复杂社交游戏中的互动模式

### 目标用户

- 狼人杀爱好者
- AI研究者
- 游戏开发者
- 想学习狼人杀的新手

## Scope

### 包含在此变更中

✅ **核心游戏引擎**
- 游戏流程控制（夜晚/白天循环）
- 6人局角色系统（2狼人、2平民、1预言家、1女巫）
- 规则引擎（技能使用、投票、胜负判定）
- 游戏状态管理

✅ **多智能体系统**
- 基于 AgentScope 的智能体框架
- GameMaster 智能体（游戏主持人）
- AIPlayer 智能体（AI玩家）
- 智能体间通信机制（MsgHub）

✅ **多模型集成**
- 统一的 LLM 适配器接口
- 支持 API 中转站配置
- 支持任意主流模型（Qwen、GPT、Claude、Gemini等）
- 灵活的模型配置和切换机制

✅ **Web 用户界面**
- Spring Boot 后端 + WebSocket 实时通信
- 前端界面（Vue/React，由用户设计UI）
- 游戏大厅（创建/加入房间）
- 游戏房间（实时游戏界面）
- 观战模式支持

✅ **人机交互**
- 人类玩家参与游戏
- 倒计时机制（60秒思考时间）
- 实时消息展示
- 纯AI对战观战模式

✅ **AI策略系统**
- 角色特定的 Prompt 设计
- 记忆管理系统
- 基础推理能力

### 不包含在此变更中（未来版本）

❌ 微信小程序版本（后续开发）
❌ 12人及更多人数局（后续扩展）
❌ 高级角色（白狼王、守墓人、骑士等）
❌ 语音交互功能
❌ 游戏录像回放和分析
❌ 多房间并发游戏
❌ 详细数据统计和可视化
❌ 排行榜和成就系统

## Success Criteria

### 功能完整性

- [ ] 能够完整运行一局6人狼人杀游戏（2狼2民1预1女）
- [ ] 支持5个AI玩家 + 1个人类玩家混合对战
- [ ] 支持6个AI玩家 + 人类观战模式
- [ ] AI玩家能够根据角色做出合理决策
- [ ] 正确执行所有游戏规则和胜负判定
- [ ] Web界面可以创建房间、加入游戏、观战

### 技术指标

- [ ] 每个AI玩家发言生成时间 < 30秒
- [ ] WebSocket 消息实时推送延迟 < 1秒
- [ ] 游戏流程无阻塞和死锁
- [ ] 所有角色技能正确实现（狼人杀人、预言家验人、女巫用药）
- [ ] 支持至少3种不同的LLM模型

### 用户体验

- [ ] 人类玩家能够清晰看到游戏状态（Web界面）
- [ ] AI玩家发言符合角色设定且有逻辑性
- [ ] 游戏流程自然流畅
- [ ] 人类玩家操作简单直观
- [ ] 倒计时准确显示且功能正常
- [ ] 观战模式可以实时看到所有玩家视角

## Implementation Strategy

### 开发阶段

#### Phase 1: 核心游戏引擎 (1周)
**目标**：实现基础游戏逻辑

- 游戏状态机（夜晚/白天循环）
- 6人局角色系统
- 规则引擎（投票、技能、胜负判定）
- 单元测试

#### Phase 2: AgentScope 集成 (1周)
**目标**：多智能体系统

- GameMaster Agent 实现
- AIPlayer Agent 基础框架
- MsgHub 消息通信
- 单模型测试（Qwen）

#### Phase 3: 多模型支持 (3-5天)
**目标**：LLM 集成

- 统一模型适配器接口
- API 中转站配置
- 至少3种模型支持
- 角色 Prompt 设计

#### Phase 4: Web 后端 (1周)
**目标**：Spring Boot API

- RESTful API（房间管理）
- WebSocket 实时通信
- 游戏会话管理
- 人类玩家接入

#### Phase 5: Web 前端 (1-2周)
**目标**：用户界面

- 游戏大厅（由用户设计UI）
- 游戏房间界面
- 实时消息展示
- 倒计时组件
- 观战模式

#### Phase 6: 测试与优化 (3-5天)
**目标**：稳定性和性能

- 完整流程测试
- AI策略调优
- 性能优化
- Bug修复

**总预计时间**：5-7周

### 技术架构

```
┌─────────────────────────────────────────┐
│         Game Master Agent               │
│   (控制流程、执行规则、广播事件)          │
└────────────┬────────────────────────────┘
             │
             ├─────── MsgHub (消息中枢) ─────┐
             │                               │
    ┌────────▼────────┐            ┌───────▼────────┐
    │  AI Player 1    │            │  AI Player 2   │
    │  (Qwen-Max)     │            │  (GPT-4)       │
    │  角色: 预言家     │            │  角色: 狼人     │
    └─────────────────┘            └────────────────┘
             │                               │
             └───────────┬───────────────────┘
                         │
                ┌────────▼──────────┐
                │  Human Player     │
                │  (CLI Interface)  │
                │  角色: 女巫        │
                └───────────────────┘
```

### 依赖项

- **AgentScope (Java)**: 多智能体框架
- **LLM SDK**:
  - 阿里云 DashScope SDK (Qwen)
  - OpenAI Java Client (GPT)
  - Anthropic SDK (Claude)
- **构建工具**: Maven
- **Java版本**: 17+

## Risks and Mitigation

### 风险1：AI推理能力不足
**描述**：LLM可能无法进行复杂的狼人杀推理

**缓解措施**：
- 设计详细的 Prompt 工程，提供推理框架
- 选用高性能模型（GPT-4、Claude Opus、Qwen-Max）
- 提供完整的游戏历史上下文
- 实现记忆检索和模式识别辅助

### 风险2：API调用成本
**描述**：频繁调用大模型API成本较高

**缓解措施**：
- 优化 Prompt 长度减少 token 消耗
- 混合使用不同价位的模型
- 实现对话摘要和上下文压缩
- 提供本地模型选项

### 风险3：实时性问题
**描述**：等待AI生成回复影响游戏体验

**缓解措施**：
- 并行调用多个模型API
- 设置合理的超时时间（30秒）
- 使用流式输出展示AI思考过程
- 提供"快速模式"选项

### 风险4：游戏公平性
**描述**：不同模型能力差异影响游戏平衡

**缓解措施**：
- 随机分配模型到不同角色
- 为弱模型提供更详细的提示
- 收集数据分析模型表现
- 动态调整模型参数

## Alternatives Considered

### 方案A：纯Web应用
❌ **不采用理由**：开发周期长，MVP阶段过于复杂

### 方案B：使用现有游戏引擎
❌ **不采用理由**：现有引擎不支持多智能体架构，需要从头开发AI部分

### 方案C：单一模型实现
❌ **不采用理由**：无法对比不同模型表现，失去研究价值

### ✅ 当前方案：AgentScope + 多模型CLI
**优势**：
- 快速验证可行性
- 充分利用 AgentScope 的多智能体能力
- 灵活的模型集成
- 后续易于扩展到 Web 界面

## Open Questions ✅ ANSWERED

所有关键问题已在需求对齐阶段明确：

1. **游戏配置**
   - [x] 首个MVP：**6人局**（2狼2民1预1女）
   - [x] 后续扩展：12人局及其他玩法
   - [x] 角色配置：基础四角色（狼人、平民、预言家、女巫）

2. **模型选择**
   - [x] **任何主流模型**均可支持（使用API中转站）
   - [x] 优先支持：Qwen、GPT、Claude、Gemini
   - [x] 暂不需要本地模型支持

3. **用户体验**
   - [x] AI发言：**正常速度**（真实生成，20-30秒）
   - [x] 人类玩家：**设置倒计时**（建议60秒）
   - [x] 观战模式：**需要支持**（人类可观看纯AI对战）

4. **技术选型**
   - [x] **直接使用 AgentScope**（不额外封装）
   - [x] 消息通信：使用 AgentScope 的 **MsgHub**

5. **界面开发**
   - [x] MVP阶段：**Web界面**（用户设计UI）
   - [x] 最终目标：**微信小程序**
   - [x] 技术栈：Spring Boot + WebSocket + Vue/React前端

## Timeline

| 阶段 | 内容 | 预计时间 |
|------|------|---------|
| **需求对齐** | 完善规范，明确技术方案 | 3天 |
| **Phase 1 MVP** | 6人简化局 + 单模型 | 2周 |
| **Phase 2 标准版** | 12人局 + 多模型 | 3-4周 |
| **Phase 3 优化** | 性能和体验提升 | 2周 |
| **总计** | | **6-8周** |

## Related Changes

- None (初始变更)

## Reviewers

- @User (项目发起人)

---

## Approval Checklist

在移动到实现阶段前，请确认：

- [ ] 项目范围清晰明确
- [ ] 技术方案可行
- [ ] Open Questions 已全部回答
- [ ] 时间线合理
- [ ] 风险已识别并有缓解措施

## Next Steps

1. ✅ 创建此提案
2. ✅ 回答 Open Questions
3. ⏳ **当前**: 编写详细规范（spec-delta.md）
4. ⏳ 制定任务清单（tasks.md）
5. ⏳ 获得用户批准
6. ⏳ 开始Phase 1实现

---

**Created**: 2025-12-11
**Author**: Claude (AI Assistant)
**Last Updated**: 2025-12-11
